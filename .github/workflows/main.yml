name: Deploy to S3 on Tag

on:
  push:
    branches: 
      - 'test-workflow'
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+*'
      - '[0-9]+.[0-9]+.[0-9]+*'
      - 'v[0-9]+.[0-9]+.[0-9]+-(CR|Beta|milestone)[0-9]*'
      - '[0-9]+.[0-9]+.[0-9]+-(CR|Beta|milestone)[0-9]*'

permissions:
  id-token: write
  contents: read

jobs:
  calling-reusable-workflow:
    uses: ./.github/workflows/reusable-workflow.yml
    with:
      s3_base_path: "s3://bootstrap-opinion-stg/playbooks"
      role: "arn:aws:iam::992382682634:role/ansible-playbook-workflow-role"
      region: "il-central-1"
      cpu_arch: "x86"
      os: "amzn2"
      app: "openvpn"
      toolkit_version: "default"